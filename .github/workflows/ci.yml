name: CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: 2.6
          bundler-cache: true
      - name: Set up Node.js
        uses: actions/setup-node@v1
        with:
          node-version: 12.x
      - name: Build site
        run: |
          bundle install
          bundle exec jekyll build
      - name: run Lighthouse CI
        run: |
          npm install -g @lhci/cli@0.8.x
          lhci autorun
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
      # - name: Compress
      #   run: |
      #     cd _site/
      #     yarn add https://github.com/tmcw/premature-optimizer
      #     git config --local user.email "$(git log --format='%ae' HEAD^!)"
      #     git config --local user.name "$(git log --format='%an' HEAD^!)"
      #     git add .
      #     git commit -m "Deploy _site/ to gh-pages"
      #     git push origin gh-pages -f
